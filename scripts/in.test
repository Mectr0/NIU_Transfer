#Multisphere

atom_style	sphere
atom_modify	map array sort 0 0
boundary	m m m
newton		off

communicate	single vel yes

#PUBLIC version only supports serial execution
#processors	1 1 1 

units		si

#region		reg block -0.3 0.3 -0.3 0.3 0. 0.5 units box
region     reg block 0  0.6 0 .6 0. 0.5 units box

create_box	1 reg

neighbor	0.004 bin
neigh_modify	delay 0

#Material properties required for new pair styles

fix 		m1 all property/global youngsModulus peratomtype 1.e7
fix 		m2 all property/global poissonsRatio peratomtype 0.45
fix 		m3 all property/global coefficientRestitution peratomtypepair 1 0.3
fix 		m4 all property/global coefficientFriction peratomtypepair 1 0.5
fix 		m5 all property/global characteristicVelocity scalar 2.

#New pair style
pair_style gran model hertz tangential history #Hertzian without cohesion
pair_coeff	* *

timestep	0.00001

fix		gravi all gravity 9.81 vector 0.0 0.0 -1.0

fix zwalls all wall/gran model hertz tangential history primitive type 1 zplane 0.0

#distributions for insertion
fix		pts1 all particletemplate/multisphere 15485867 atom_type 1 density constant 2500 nspheres 70 ntry 1000000 spheres file ../data/in.PelletV3 scale 0.001 type 1
fix		pdd1 all particledistribution/discrete 39659 1 pts1 0.1 #15485867
fix             pts2 all particletemplate/multisphere 123457 atom_type 1 density constant 2500 nspheres 70 ntry 1000000 spheres file ../data/in.PelletV3 scale 0.001 type 2
fix             pdd2 all particledistribution/discrete 39659 1 pts2 0.1
fix             pts3 all particletemplate/multisphere 123457 atom_type 1 density constant 2500 nspheres 70 ntry 1000000 spheres file ../data/in.PelletV3 scale 0.001 type 3
fix             pdd3 all particledistribution/discrete 39659 1 pts3 0.1
fix             pts4 all particletemplate/multisphere 123457 atom_type 1 density constant 2500 nspheres 70 ntry 1000000 spheres file ../data/in.PelletV3 scale 0.001 type 4
fix             pdd4 all particledistribution/discrete 39659 1 pts4 0.1
fix             pts5 all particletemplate/multisphere 123457 atom_type 1 density constant 2500 nspheres 70 ntry 1000000 spheres file ../data/in.PelletV3 scale 0.001 type 5
fix             pdd5 all particledistribution/discrete 39659 1 pts5 0.1

#region and insertion
#region		bc cylinder z 0.0 0.0 0.25 0.1 0.4 units box
region     bc block 0.1  0.5 0.1 .5 0.1 0.2 units box
region     delete block 0.1 0.5 0.1 .5 0 0.05 units box
region     box1 block 0.1 0.5 0.1 .5 0.4 0.45 units box
region     box2 block 0.1 0.5 0.1 .5 0.35 0.4 units box
region     box3 block 0.1 0.5 0.1 .5 0.3 0.35 units box

fix		ins all insert/pack seed 32452843 distributiontemplate pdd1 vel constant 0. 0. 0. orientation random &
		insert_every once overlapcheck yes region bc ntry_mc 10000 particles_in_region 500

################################################
#fix             ins2 all insert/pack seed 49979693 distributiontemplate pdd2 vel constant 0. 0. 0. orientation random &
 #               insert_every once overlapcheck yes region delete ntry_mc 10000 particles_in_region 500
#fix             ins3 all insert/pack seed 49979693 distributiontemplate pdd3 vel constant 0. 0. 0. orientation constant 0.7071067624 -0.7071068 0 0 &
                #insert_every once overlapcheck yes region box1 ntry_mc 10000 particles_in_region 1
#fix             ins4 all insert/pack seed 49979693 distributiontemplate pdd4 vel constant 0. 0. 0. orientation template &
                #insert_every once overlapcheck yes region box2 ntry_mc 10000 particles_in_region 1
#fix             ins5 all insert/pack seed 49979693 distributiontemplate pdd5 vel constant 0. 0. 0. orientation constant 0.7071067624 0 0.7071068 0 &
#                insert_every once overlapcheck yes region box3 ntry_mc 10000 particles_in_region 1
################################################
#
#integrator for multisphere rigid bodies
fix		integr all multisphere
#output settings, include total thermal energy
compute		1 all erotate/sphere
compute bid all multisphere property id_multisphere
compute quat all multisphere property quat
compute pos  all multisphere property xcm
compute vel all multisphere property vcm

compute energy all ke
#fix		ts all check/timestep/gran 1000 0.1 0.1
#thermo_style	custom step atoms ke c_1 f_ts[1] f_ts[2] vol
#thermo		1000
#thermo_modify	lost ignore norm no

#run 1

dump		dmp all custom/vtk 200 post/multi_*.vtk id type mol x y z vx vy vz fx fy fz omegax omegay omegaz radius
#dump       orien all local 500 post/dump.test c_bid c_quat[1] c_quat[2] c_quat[3] c_quat[4] &
#           c_pos[1] c_pos[2] c_pos[3] c_vel[1] c_vel[2] c_vel[3]
#dump        pel all custom 500 post/dump.posrand.xyz id_multisphere xs ys zs
#dump_modify pel sort id
#dump       pos  all local 200 post/dump.pellet_pos c_pos[1] c_pos[2] c_pos[3]

#insert particles
#restart 20000 restart.test
run		40000 upto #every 200 "delete_atoms region delete"
